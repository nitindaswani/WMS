<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - WMS Portal</title>
    <link rel="stylesheet" href="/public/css/variables.css">
    <link rel="stylesheet" href="/public/css/reset.css">
    <link rel="stylesheet" href="/public/css/layout.css">
    <link rel="stylesheet" href="/public/css/components.css">
    <link rel="stylesheet" href="/public/css/animations.css">
    <style>
        .banner {
            background: linear-gradient(90deg, #3A7BFF 0%, #9D4BFF 100%);
            border-radius: var(--radius-lg);
            padding: 32px;
            color: white;
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>

<body>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar"></aside>

        <main class="main-content">
            <!-- Navbar -->
            <div id="navbar"></div>

            <!-- Welcome Banner -->
            <div class="banner fade-in">
                <div>
                    <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 8px;">Welcome back, Jane!</h1>
                    <p style="opacity: 0.9;">You have 2 upcoming workshops this week.</p>
                </div>
                <img src="https://cdni.iconscout.com/illustration/premium/thumb/coding-3462274-2895956.png"
                    alt="Learning" style="height: 120px; display: none; @media(min-width: 768px){display: block;}">
            </div>

            <!-- Quick Stats -->
            <section class="grid-3 stagger-children">
                <div class="card stat-card float-hover">
                    <div class="stat-value" id="stat-attended">-</div>
                    <div class="stat-label">Workshops Attended</div>
                </div>
                <div class="card stat-card float-hover">
                    <div class="stat-value" id="stat-certificates">-</div>
                    <div class="stat-label">Certificates Earned</div>
                </div>
                <div class="card stat-card float-hover">
                    <div class="stat-value">12h</div>
                    <div class="stat-label">Learning Time</div>
                </div>
            </section>

            <!-- Upcoming Registrations -->
            <section class="fade-in" style="margin-top: 32px; animation-delay: 0.3s;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h2 style="font-size: 1.25rem; font-weight: 600;">Upcoming Workshops</h2>
                    <a href="my-registrations.html" style="color: var(--primary);">View All</a>
                </div>

                <div class="grid-2" id="upcoming-grid">
                    <div style="color:var(--text-muted);">Loading...</div>
                </div>
            </section>

        </main>
    </div>

    <script src="/public/js/config.js"></script>
    <script src="/public/js/auth.js"></script>
    <script src="/public/js/dom.js"></script>
    <script>
        async function loadComponents() {
            // Load Sidebar
            const sidebarRes = await fetch('/components/user-sidebar.html');
            document.getElementById('sidebar').innerHTML = await sidebarRes.text();

            // Load Navbar
            const navbarRes = await fetch('/components/user-navbar.html');
            document.getElementById('navbar').innerHTML = await navbarRes.text();

            loadDashboard();
        }

        async function loadDashboard() {
            try {
                const res = await Auth.authenticatedFetch(`${CONFIG.API_BASE_URL}/workshops/analytics/`);
                if (res.ok) {
                    const data = await res.json();

                    // Update Stats
                    // Note: IDs missing in HTML, need to add them or select by index.
                    // Lets update HTML part next.
                    // Assuming IDs present for now to write logic.
                    document.getElementById('stat-attended').innerText = data.total_registrations || 0;
                    document.getElementById('stat-certificates').innerText = data.certificates || 0;

                    // Update Upcoming Container
                    const upcomingContainer = document.getElementById('upcoming-grid');
                    upcomingContainer.innerHTML = '';

                    if (data.upcoming_workshops && data.upcoming_workshops.length > 0) {
                        data.upcoming_workshops.forEach(w => {
                            const div = document.createElement('div');
                            div.className = 'card';
                            div.innerHTML = `
                                <div style="display:flex;justify-content:space-between;">
                                    <h3 style="font-weight:600;">${w.title}</h3>
                                    <span class="badge badge-success">Registered</span>
                                </div>
                                <p style="color:var(--text-muted);font-size:0.9rem;margin-top:4px;">${w.start_date}</p>
                                <button class="btn btn-primary" style="margin-top:12px;width:100%;" onclick="window.location.href='workshop-details.html?id=${w.id}'">View Details</button>
                            `;
                            upcomingContainer.appendChild(div);
                        });
                    } else {
                        upcomingContainer.innerHTML = '<div style="color:var(--text-muted);">No upcoming workshops found. <a href="workshop-list.html">Browse Workshops</a></div>';
                    }

                }
            } catch (e) {
                console.error(e);
            }
        }

        loadComponents();
    </script>
</body>

</html>